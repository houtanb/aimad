!
! Copyright (C) 2006-2014 Houtan Bastani and Luca Guerrieri
!
!
! This free software: you can redistribute it and/or modify
! it under the terms of the GNU General Public License as published by
! the Free Software Foundation, either version 3 of the License, or
! (at your option) any later version.
!
! It is distributed in the hope that it will be useful,
! but WITHOUT ANY WARRANTY; without even the implied warranty of
! MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
! GNU General Public License for more details.
!
! You should have received a copy of the GNU General Public License
! along with Dynare.  If not, see <http://www.gnu.org/licenses/>.
!

!        Generated by TAPENADE     (INRIA, Tropics team)
!  Tapenade - Version 2.2 (r1239) - Wed 28 Jun 2006 04:59:55 PM CEST
!
!  Differentiation of splitmat in forward (tangent) mode: (multi-directional mode)
!   variations  of output variables: bmat amat
!   with respect to input variables: cofb
SUBROUTINE SPLITMAT_DV(cofb, cofbd, endog, nendogvars, errlist, nerrvars, amat, amatd, bmat, bmatd, nbdirs)
  USE DIFFSIZES
  IMPLICIT NONE
  INTEGER :: nbdirs
  INTEGER, INTENT(INOUT) :: nendogvars
  DOUBLE PRECISION, DIMENSION(nendogvars, nendogvars), INTENT(IN) :: &
&  cofb
  DOUBLE PRECISION, DIMENSION(nbdirsmax, nendogvars, nendogvars)&
&  , INTENT(IN) :: cofbd
  CHARACTER(len=*), DIMENSION(nendogvars), INTENT(INOUT) :: endog
  INTEGER, INTENT(IN) :: nerrvars
  DOUBLE PRECISION, DIMENSION(nendogvars-nerrvars, nendogvars-nerrvars)&
&  , INTENT(OUT) :: amat
  DOUBLE PRECISION, DIMENSION(nbdirsmax, nendogvars-nerrvars, nendogvars&
&  -nerrvars), INTENT(OUT) :: amatd
  DOUBLE PRECISION, DIMENSION(nendogvars-nerrvars, nerrvars)&
&  , INTENT(OUT) :: bmat
  DOUBLE PRECISION, DIMENSION(nbdirsmax, nendogvars-nerrvars, nerrvars)&
&  , INTENT(OUT) :: bmatd
  CHARACTER(len=*), DIMENSION(nerrvars), INTENT(IN) :: errlist
  INTEGER :: endogindx, endogposlist(nendogvars-nerrvars), errindx, &
&  errposlist(nerrvars), i, nd, result1, STRMATCH
!LOCAL VARS
  errindx = 0
  errposlist(:) = 0
  endogindx = 0
  endogposlist(:) = 0
  DO i=1,nendogvars
    result1 = STRMATCH(endog(i), errlist, nerrvars)
    IF (result1 .LT. 0) THEN
      endogindx = endogindx + 1
      endogposlist(endogindx) = i
    ELSE
      errindx = errindx + 1
      errposlist(errindx) = i
    END IF
  END DO
  amat(:, :) = 0.0d0
  bmat(:, :) = 0.0d0
  DO nd=1,nbdirs
    amatd(nd, :, :) = cofbd(nd, endogposlist, endogposlist)
    bmatd(nd, :, :) = cofbd(nd, endogposlist, errposlist)
  END DO
  amat = cofb(endogposlist, endogposlist)
  bmat = cofb(endogposlist, errposlist)
  DO i=1,nendogvars
    IF (i .GT. nendogvars - nerrvars) THEN
      endog(i) = ''
    ELSE
      endog(i) = endog(endogposlist(i))
    END IF
  END DO
  nendogvars = nendogvars - nerrvars
END SUBROUTINE SPLITMAT_DV
